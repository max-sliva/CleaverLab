<!DOCTYPE html>
<html>
<head>
    <script src="konva.min.js"></script>
    <meta charset="utf-8"/>
    <title>Konva Drag and Drop an Image Demo</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <script>
        var width = window.innerWidth;
        var height = window.innerHeight;
        var stage = new Konva.Stage({
            container: 'container',
            width: width,
            height: height,
        });
        var layer = new Konva.Layer();
        var objTargets = [];
        var line = new Konva.Line({
            points: [0, 0, 200, 200],
            stroke: 'green',
            strokeWidth: 2,
        });
        layer.add(line);
        stage.add(layer);

        function drawImage(imageObj) {
            // darth vader
            var img = new Konva.Image({
                image: imageObj,
                x: stage.width() / 2 - 200 / 2,
                y: stage.height() / 2 - 137 / 2,
                width: 200,
                height: 137,
                draggable: true,
            });

            // add cursor styling
            img.on('mouseover', function () {
                document.body.style.cursor = 'pointer';
            });
            img.on('mouseout', function () {
                document.body.style.cursor = 'default';
            });

            layer.add(img);
            stage.add(layer);
            objTargets.push(img);
        }

        var raspiImg = new Image();
        raspiImg.onload = function () {
            drawImage(this);
        };
        raspiImg.src = 'RaspberryPi_3B.png';
        var arduImg = new Image();
        arduImg.onload = function () {
            drawImage(this);
            layer.add(line);
            stage.add(layer);
            objTargets.forEach((target) => {
                target.on('dragmove', updateLine);
            });
        };
        arduImg.src = 'iskra2.jpg';

        function updateLine() {
            // console.log("width = ", objTargets[0].width());
            line.points([objTargets[0].x()+objTargets[0].width(), objTargets[0].y()+objTargets[0].height()/2, objTargets[1].x(), objTargets[1].y()+objTargets[1].height()/2]);
            layer.batchDraw();
        }
    </script>

</body>
</html>